<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-http/2020.11.25.overview_the_websocket_mechanism">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Overview The WebSocket Mechanism | jerry.wang&#x27;s blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://wangs.cloud/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://wangs.cloud/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://wangs.cloud/docs/http/2020.11.25.overview_the_websocket_mechanism"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Overview The WebSocket Mechanism | jerry.wang&#x27;s blog"><meta data-rh="true" name="description" content="This article introduces What’s the Websocket and how it works."><meta data-rh="true" property="og:description" content="This article introduces What’s the Websocket and how it works."><meta data-rh="true" name="keywords" content="websocket,http"><link data-rh="true" rel="icon" href="/img/programmer.png"><link data-rh="true" rel="canonical" href="https://wangs.cloud/docs/http/2020.11.25.overview_the_websocket_mechanism"><link data-rh="true" rel="alternate" href="https://wangs.cloud/docs/http/2020.11.25.overview_the_websocket_mechanism" hreflang="en"><link data-rh="true" rel="alternate" href="https://wangs.cloud/docs/http/2020.11.25.overview_the_websocket_mechanism" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CV3DEYG0V5"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CV3DEYG0V5",{})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.21f63a90.css">
<link rel="preload" href="/assets/js/runtime~main.57cd1f60.js" as="script">
<link rel="preload" href="/assets/js/main.9ff24e22.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Jerry.Wang Blog</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/zi-xiang-wang-56073a1a2/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Jerry Wang Blog</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/golang/2021.10.23.advance_golang">Golang</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/database/2021.04.18.smalltalk_nosql">Database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/http/2020.11.25.overview_the_websocket_mechanism">HTTP</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/http/2020.11.25.overview_the_websocket_mechanism">Overview The WebSocket Mechanism</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/patterns/2021.09.04.from_mod_to_structure">Pattern</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/broker/2020.11.11.what_is_broker">Broker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/blockchain/2021.03.07.blockchain_issues">Blockchain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/k8s/2022.02.14.shorttalk_k8s">Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/security/2020.12.20.auth_2_tutorial">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/torch/2020.11.04.torch_server_tutorial">Torch</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/web_rtc/2020.11.19.apprtc_tutorial">WebRTC</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HTTP</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Overview The WebSocket Mechanism</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Overview The WebSocket Mechanism</h1><p>WebSocket is a popular tool in HTTP 1.1, that realized full-duplex on HTTP model. <strong>It upgrades HTTP 1.1 to let the TCP channel still open</strong> until the request or response side closes the communication channel.</p><p>In the past without the WebSocket age, there are two mechanisms to achieve duplex. One is &quot;Long Polling&quot; the other one is &quot;HTTP stream&quot;, they manipulate the request channel time to simulate duplex<!-- -->[<!-- -->1]. On the other worlds, that just don&#x27;t close HTTP Request. But it have a drawback that caused server big loading but WebSocket can solve these problem</p><blockquote><p>Detail in attachment about &quot; Long Polling&quot; and &quot; HTTP Stream&quot;</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-design-of-websocket"><strong>The Design of Websocket</strong><a href="#the-design-of-websocket" class="hash-link" aria-label="Direct link to the-design-of-websocket" title="Direct link to the-design-of-websocket">​</a></h3><p>The WebSocket build connection have two steps. Client should start TCP connection and then use HTTP GET to verify HTTP upgrade process <strong>(Websocket HandShake)</strong> before staring transmit data.</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/720/1*_vUlATmL9eAcy5VzsjUjng.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="websocket-handshake">WebSocket handshake<a href="#websocket-handshake" class="hash-link" aria-label="Direct link to WebSocket handshake" title="Direct link to WebSocket handshake">​</a></h3><p>WebScoket handshake base on HTTP 1.1 to do this. The main purpose is client side tells HTTP Server we want to upgrade to WebSocket.(Figure WebSocket handshake sequence diagram)</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/720/1*lFsewXqqMdpeSagStXFuow.png" alt="WebSocket handshake sequence diagram" class="img_ev3q"></p><p><strong>Something Important:</strong> ● Sec-WebSocket-key, Sec-Websocket-Accept: The purpose is that proves the handshake was received \1. Sec-Websocket-key is a UUID that encoded by Base64. \2. Sec-Websocket-Accept is the string that Sec-Websocket-key concatenates with decode of Sec-Websocket-key. The string will encode SHA-1 and encode Base64 before send back it.</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/720/1*r18KMh7e4WKNc_8hlCuL1g.png" alt="Sec-WebSocket-key, Sec-Websocket-Accept activity diagram" class="img_ev3q"></p><p>● Origin: The Origin header field is used to protect against <strong>unauthorized cross-origin</strong> use of a WebSocket server by scripts using the WebSocket API in a web browser. <strong>example:</strong> if code downloaded from <a href="http://www.example.com" target="_blank" rel="noopener noreferrer">www.example.com</a> attempts to establish a connection to ww2.example.com, the value of the header field would be &quot;<a href="http://www.example.com" target="_blank" rel="noopener noreferrer">http://www.example.com</a>&quot;</p><p>● Sec-WebSocket-Version: The value of this header field MUST be <strong>13</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="three-control-frame-ping-pong-close">Three Control Frame: Ping, Pong, Close<a href="#three-control-frame-ping-pong-close" class="hash-link" aria-label="Direct link to Three Control Frame: Ping, Pong, Close" title="Direct link to Three Control Frame: Ping, Pong, Close">​</a></h3><p><strong>● Ping</strong> Upon receipt of a Ping frame, an endpoint MUST send a <strong>Pong frame</strong> in response, unless it already received a Close frame.</p><p><strong>● Pong</strong> (not only reply ping but <strong>it can serve as a unidirectional heartbeat</strong>) If an endpoint receives not only one ping, that <strong>May</strong> elect the most recent ping to reply a Pong.</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/720/1*WLwBU5-dSm9baYOe0QsbgA.png" alt="Ping and Pong example" class="img_ev3q"></p><p><strong>● Close</strong> If the endpoint receives <strong>a close control frame,</strong> it MUST send a Close frame in response.</p><blockquote><p>Sometimes endpoint receive a close frame, but some data still transmit. In that situation, endpoint can send a close frame after this transmit.</p></blockquote><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/720/1*-tUT8eVHh8Kg3eEmomlfcg.png" alt="when receive close control frame, endpoint can done it before send close back" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion"><strong>Conclusion</strong><a href="#conclusion" class="hash-link" aria-label="Direct link to conclusion" title="Direct link to conclusion">​</a></h3><p>WebSocket is so popular on Web event implementation but seldom do people realize how it works. In this article, have some essential knowledge to help people develop the WebSocket Application. Especially WebSocket handshake, so many modules should set these arguments.</p><p><strong>Attachment</strong>: ● Long Polling: When a client sends a request but the server does not close this connection a period. if it is closed, the client will still resend a request to do it again.</p><p>● HTTP Stream: When the client sends a request but the server never closes this connection.</p><blockquote><p><em>In both of them, the Server response still has an HTTP header and no mechanism to manage the endpoint connection status.</em></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h3><p>[1]<!-- -->Loreto, S., et al. “RFC 6202-Known Issues and Best Practices for the Use of Long Polling and Streaming in Bidirectional HTTP.” <em>IETF, Duben</em> (2011).<br>
<!-- -->[2]<!-- --> Skvorc, Dejan, Matija Horvat, and Sinisa Srbljic. “Performance evaluation of Websocket protocol for implementation of full-duplex web streams.” <em>2014 37th International Convention on Information and Communication Technology, Electronics and Microelectronics (MIPRO)</em>. IEEE, 2014.<br>
<!-- -->[3]<!-- -->Fette, Ian, and Alexey Melnikov. “Rfc 6455: The websocket protocol.” <em>IETF, December</em> (2011).<br></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/database/2022.09.23.how_pick_database"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How do pick the database more correctly</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/patterns/2021.09.04.from_mod_to_structure"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Domain Model: 從無到有規劃新的服務</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-design-of-websocket" class="table-of-contents__link toc-highlight"><strong>The Design of Websocket</strong></a></li><li><a href="#websocket-handshake" class="table-of-contents__link toc-highlight">WebSocket handshake</a></li><li><a href="#three-control-frame-ping-pong-close" class="table-of-contents__link toc-highlight">Three Control Frame: Ping, Pong, Close</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight"><strong>Conclusion</strong></a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Jerry.wang blog, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.57cd1f60.js"></script>
<script src="/assets/js/main.9ff24e22.js"></script>
</body>
</html>