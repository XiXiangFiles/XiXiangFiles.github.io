"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[396],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},m="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=l(n),d=a,u=m["".concat(c,".").concat(d)]||m[d]||h[d]||r;return n?o.createElement(u,s(s({ref:t},p),{},{components:n})):o.createElement(u,s({ref:t},p))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[m]="string"==typeof e?e:a,s[1]=i;for(var l=2;l<r;l++)s[l]=n[l];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6856:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var o=n(7462),a=(n(7294),n(3905));const r={title:"Overview The WebSocket Mechanism",description:"This article introduces What\u2019s the Websocket and how it works.",keywords:["websocket","http"],sidebar_position:1},s="Overview The WebSocket Mechanism",i={unversionedId:"http/2020.11.25.overview_the_websocket_mechanism",id:"http/2020.11.25.overview_the_websocket_mechanism",title:"Overview The WebSocket Mechanism",description:"This article introduces What\u2019s the Websocket and how it works.",source:"@site/docs/http/2020.11.25.overview_the_websocket_mechanism.md",sourceDirName:"http",slug:"/http/2020.11.25.overview_the_websocket_mechanism",permalink:"/docs/http/2020.11.25.overview_the_websocket_mechanism",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Overview The WebSocket Mechanism",description:"This article introduces What\u2019s the Websocket and how it works.",keywords:["websocket","http"],sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"How do pick the database more correctly",permalink:"/docs/database/2022.09.23.how_pick_database"},next:{title:"Domain Model: \u5f9e\u7121\u5230\u6709\u898f\u5283\u65b0\u7684\u670d\u52d9",permalink:"/docs/patterns/2021.09.04.from_mod_to_structure"}},c={},l=[{value:"<strong>The Design of Websocket</strong>",id:"the-design-of-websocket",level:3},{value:"WebSocket handshake",id:"websocket-handshake",level:3},{value:"Three Control Frame: Ping, Pong, Close",id:"three-control-frame-ping-pong-close",level:3},{value:"<strong>Conclusion</strong>",id:"conclusion",level:3},{value:"Reference",id:"reference",level:3}],p={toc:l},m="wrapper";function h(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"overview-the-websocket-mechanism"},"Overview The WebSocket Mechanism"),(0,a.kt)("p",null,"WebSocket is a popular tool in HTTP 1.1, that realized full-duplex on HTTP model. ",(0,a.kt)("strong",{parentName:"p"},"It upgrades HTTP 1.1 to let the TCP channel still open")," until the request or response side closes the communication channel."),(0,a.kt)("p",null,'In the past without the WebSocket age, there are two mechanisms to achieve duplex. One is "Long Polling" the other one is "HTTP stream", they manipulate the request channel time to simulate duplex',"[","1]. On the other worlds, that just don't close HTTP Request. But it have a drawback that caused server big loading but WebSocket can solve these problem"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'Detail in attachment about " Long Polling" and " HTTP Stream"')),(0,a.kt)("h3",{id:"the-design-of-websocket"},(0,a.kt)("strong",{parentName:"h3"},"The Design of Websocket")),(0,a.kt)("p",null,"The WebSocket build connection have two steps. Client should start TCP connection and then use HTTP GET to verify HTTP upgrade process ",(0,a.kt)("strong",{parentName:"p"},"(Websocket HandShake)")," before staring transmit data."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/720/1*_vUlATmL9eAcy5VzsjUjng.png",alt:null})),(0,a.kt)("h3",{id:"websocket-handshake"},"WebSocket handshake"),(0,a.kt)("p",null,"WebScoket handshake base on HTTP 1.1 to do this. The main purpose is client side tells HTTP Server we want to upgrade to WebSocket.(Figure WebSocket handshake sequence diagram)"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/720/1*lFsewXqqMdpeSagStXFuow.png",alt:"WebSocket handshake sequence diagram"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Something Important:")," \u25cf Sec-WebSocket-key, Sec-Websocket-Accept: The purpose is that proves the handshake was received \\1. Sec-Websocket-key is a UUID that encoded by Base64. \\2. Sec-Websocket-Accept is the string that Sec-Websocket-key concatenates with decode of Sec-Websocket-key. The string will encode SHA-1 and encode Base64 before send back it."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/720/1*r18KMh7e4WKNc_8hlCuL1g.png",alt:"Sec-WebSocket-key, Sec-Websocket-Accept activity diagram"})),(0,a.kt)("p",null,"\u25cf Origin: The Origin header field is used to protect against ",(0,a.kt)("strong",{parentName:"p"},"unauthorized cross-origin")," use of a WebSocket server by scripts using the WebSocket API in a web browser. ",(0,a.kt)("strong",{parentName:"p"},"example:")," if code downloaded from ",(0,a.kt)("a",{parentName:"p",href:"http://www.example.com"},"www.example.com"),' attempts to establish a connection to ww2.example.com, the value of the header field would be "',(0,a.kt)("a",{parentName:"p",href:"http://www.example.com"},"http://www.example.com"),'"'),(0,a.kt)("p",null,"\u25cf Sec-WebSocket-Version: The value of this header field MUST be ",(0,a.kt)("strong",{parentName:"p"},"13"),"."),(0,a.kt)("h3",{id:"three-control-frame-ping-pong-close"},"Three Control Frame: Ping, Pong, Close"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u25cf Ping")," Upon receipt of a Ping frame, an endpoint MUST send a ",(0,a.kt)("strong",{parentName:"p"},"Pong frame")," in response, unless it already received a Close frame."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u25cf Pong")," (not only reply ping but ",(0,a.kt)("strong",{parentName:"p"},"it can serve as a unidirectional heartbeat"),") If an endpoint receives not only one ping, that ",(0,a.kt)("strong",{parentName:"p"},"May")," elect the most recent ping to reply a Pong."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/720/1*WLwBU5-dSm9baYOe0QsbgA.png",alt:"Ping and Pong example"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u25cf Close")," If the endpoint receives ",(0,a.kt)("strong",{parentName:"p"},"a close control frame,")," it MUST send a Close frame in response."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Sometimes endpoint receive a close frame, but some data still transmit. In that situation, endpoint can send a close frame after this transmit.")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/720/1*-tUT8eVHh8Kg3eEmomlfcg.png",alt:"when receive close control frame, endpoint can done it before send close back"})),(0,a.kt)("h3",{id:"conclusion"},(0,a.kt)("strong",{parentName:"h3"},"Conclusion")),(0,a.kt)("p",null,"WebSocket is so popular on Web event implementation but seldom do people realize how it works. In this article, have some essential knowledge to help people develop the WebSocket Application. Especially WebSocket handshake, so many modules should set these arguments."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Attachment"),": \u25cf Long Polling: When a client sends a request but the server does not close this connection a period. if it is closed, the client will still resend a request to do it again."),(0,a.kt)("p",null,"\u25cf HTTP Stream: When the client sends a request but the server never closes this connection."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("em",{parentName:"p"},"In both of them, the Server response still has an HTTP header and no mechanism to manage the endpoint connection status."))),(0,a.kt)("h3",{id:"reference"},"Reference"),(0,a.kt)("p",null,"[1]","Loreto, S., et al. \u201cRFC 6202-Known Issues and Best Practices for the Use of Long Polling and Streaming in Bidirectional HTTP.\u201d ",(0,a.kt)("em",{parentName:"p"},"IETF, Duben")," (2011).",(0,a.kt)("br",null),"\n","[2]"," Skvorc, Dejan, Matija Horvat, and Sinisa Srbljic. \u201cPerformance evaluation of Websocket protocol for implementation of full-duplex web streams.\u201d ",(0,a.kt)("em",{parentName:"p"},"2014 37th International Convention on Information and Communication Technology, Electronics and Microelectronics (MIPRO)"),". IEEE, 2014.",(0,a.kt)("br",null),"\n","[3]","Fette, Ian, and Alexey Melnikov. \u201cRfc 6455: The websocket protocol.\u201d ",(0,a.kt)("em",{parentName:"p"},"IETF, December")," (2011).",(0,a.kt)("br",null)))}h.isMDXComponent=!0}}]);